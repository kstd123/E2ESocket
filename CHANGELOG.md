# 更新日志

## [2.1.0] - 2025-11-17

### ✨ 新增功能

#### 📝 房间配置管理

管理员可以发布和管理房间JSON配置：

- **发布配置**: 管理员可以发布JSON格式的配置数据
- **实时广播**: 配置更新自动广播给所有房间成员
- **版本管理**: 每次发布配置时版本号自动递增
- **配置替换**: 新配置自动替换旧配置
- **可视化编辑器**: 内置JSON配置编辑器，支持语法验证
- **自动分发**: 新成员加入时自动接收最新配置

**使用场景**:
- 游戏房间设置
- 协作工具配置
- 数据模板分发
- 规则和设置共享

#### 📱 二维码加入房间

快速加入房间的二维码功能：

- **自动生成**: 创建房间后自动生成二维码
- **多种格式**: 支持PNG、SVG、Data URL格式
- **扫码加入**: 扫描二维码自动加入房间
- **配置同步**: 加入后自动接收最新配置
- **URL参数**: 支持通过URL参数自动加入

**API端点**:
```
GET /api/rooms/:roomId/qrcode?format=data
```

#### 新增消息类型

**WebSocket消息**:
- `publish_config` - 发布配置（仅管理员）
- `get_config` - 获取当前配置
- `config_update` - 配置更新推送
- 广播事件: `config_published` - 配置已发布

#### UI优化

**管理员专属按钮**:
- 📱 二维码按钮 - 显示房间二维码
- ⚙️ 配置按钮 - 打开配置编辑器
- 管理员身份标识

**新增模态框**:
- 配置编辑器 - 编辑和发布JSON配置
- 二维码显示 - 显示房间加入二维码

### 🔧 改进

- 加入房间时自动接收最新配置
- 房间信息中显示配置版本
- 配置JSON格式验证
- 优化管理员权限判断逻辑

### 📚 文档

- 新增: `docs/配置管理和二维码功能.md` - 完整功能文档
- 包含API文档、使用示例、工作流程等

### 📦 依赖

- 新增: `qrcode@^1.5.3` - 二维码生成库

**相关文件**:
- 修改: `package.json` - 添加qrcode依赖
- 修改: `src/websocket/RoomManager.js` - 添加配置管理方法
- 修改: `src/websocket/WebSocketServer.js` - 添加配置消息处理
- 修改: `src/api/routes.js` - 添加二维码API
- 修改: `examples/client.html` - 添加配置编辑器和二维码功能

---

## [2.0.0] - 2025-11-17

### 🎨 重大更新：微信风格界面

完全重新设计了浏览器客户端界面，采用微信电脑版风格！

#### ✨ 新增功能

**全新界面设计**:
- 左右分栏布局（侧边栏 + 聊天区）
- 微信风格的气泡消息
  - 自己的消息：绿色气泡，右对齐
  - 别人的消息：白色气泡，左对齐
  - 带有三角箭头指示
- 系统消息居中显示
- 现代化的配色方案（微信绿 #07C160）

**左侧边栏**:
- 在线状态指示灯（绿色/红色）
- 简化的连接控制面板
- 快速加入房间面板
- 当前房间信息卡片
  - 房间号
  - 在线人数徽章
  - 权限显示

**聊天区域**:
- 清晰的聊天头部
  - 房间标题
  - 在线人数统计
  - 快捷操作按钮
- 流畅的消息滚动
- 自动滚动到最新消息
- 气泡样式消息展示

**输入区域**:
- 工具栏（表情、文件、图片图标）
- 大型消息输入框
- 按 Enter 快速发送
- 醒目的绿色发送按钮
- 智能禁用状态

**交互优化**:
- 平滑的动画过渡
- 悬停效果
- 清晰的状态反馈
- 优雅的滚动条样式
- 响应式设计

#### 🎯 改进

- **视觉设计**: 从渐变紫色改为微信绿色主题
- **布局结构**: 从单栏居中改为左右分栏
- **消息样式**: 从列表式改为气泡式
- **用户体验**: 更直观、更现代化
- **信息层次**: 更清晰的视觉层次

#### 📚 文档

- 新增: `examples/UI更新说明.md` - 详细的界面更新说明
- 包含界面预览、使用方法、样式特点等

#### 🆚 对比

| 特性 | v1.x | v2.0 |
|------|------|------|
| 布局 | 单栏居中 | 左右分栏 |
| 消息样式 | 列表式 | 气泡式 |
| 配色 | 渐变紫色 | 微信绿 |
| 用户体验 | 功能性 | 现代化 |

**相关文件**:
- 修改: `examples/client.html` - 完全重新设计

---

## [1.1.0] - 2025-11-17

### ✨ 新增功能

#### 🔌 端口自动切换

添加了智能端口管理功能，服务器启动时会自动检测端口是否可用：

- **自动检测**: 启动时自动检测配置的端口是否被占用
- **智能切换**: 如果端口被占用，自动查找并使用下一个可用端口
- **友好提示**: 清晰显示端口变更信息
- **环境变量**: 支持通过环境变量配置端口
- **错误处理**: 完善的错误处理和用户提示

**使用示例**:

```bash
# 直接启动，自动处理端口冲突
npm start

# 如果端口被占用，会显示：
# ⚠️  WebSocket 端口 8080 被占用，使用备用端口 8081
# ✓ WebSocket Server: ws://localhost:8081
```

**环境变量配置**:

```bash
WS_PORT=9090 API_PORT=4000 npm start
```

**相关文件**:
- 新增: `src/utils/port-finder.js` - 端口查找工具
- 修改: `server.js` - 添加端口自动切换逻辑
- 修改: `src/websocket/WebSocketServer.js` - 支持异步启动
- 修改: `config/config.js` - 添加环境变量支持
- 新增: `docs/PORT_MANAGEMENT.md` - 详细的端口管理文档
- 新增: `scripts/test-port-switching.js` - 端口切换测试脚本

### 📚 文档更新

- 更新 `README.md` - 添加端口自动切换说明
- 更新 `QUICKSTART.md` - 更新常见问题解答
- 更新 `START_HERE.md` - 更新故障排查指南
- 更新 `项目说明.md` - 添加端口配置详细说明
- 新增 `docs/PORT_MANAGEMENT.md` - 完整的端口管理指南

### 🔧 改进

- **更好的用户体验**: 减少手动配置需求
- **开发友好**: 支持多个开发实例同时运行
- **生产就绪**: 灵活的端口配置方式

### 🛠️ 测试

新增测试脚本：

```bash
# 测试端口切换功能
npm run test:port
```

---

## [1.0.0] - 2025-11-17

### 🎉 首次发布

#### 核心功能

- ✅ **WebSocket 双工通信** - 实时双向数据传输
- ✅ **房间管理系统** - 创建、加入、离开房间
- ✅ **权限控制** - 管理员、读写、只读三种权限
- ✅ **端到端加密** - 基于 Signal 协议的加密通信
- ✅ **实时广播** - 消息广播给房间内所有成员
- ✅ **在线状态** - 实时显示房间在线人数
- ✅ **HTTP API** - RESTful API 接口

#### 高级功能

- 🔐 公钥注册和分发
- 👑 管理员权限（踢人、修改权限）
- 🔒 房间权限控制（只读/读写）
- 💬 点对点消息和广播消息
- 📊 服务器统计信息
- 🧹 自动清理过期房间

#### 部署支持

- Docker 容器化
- PM2 进程管理
- Nginx 反向代理配置
- 环境变量配置

#### 文档

- 完整的 README
- 快速开始指南
- 部署指南
- 项目总结
- 多个示例代码

#### 测试

- 连接测试脚本
- 浏览器客户端示例
- Node.js 客户端示例
- 多客户端测试
- 加密通信测试

---

## 版本说明

### 语义化版本

本项目遵循 [语义化版本 2.0.0](https://semver.org/lang/zh-CN/)：

- **主版本号**: 不兼容的 API 修改
- **次版本号**: 向下兼容的功能性新增
- **修订号**: 向下兼容的问题修正

### 更新类型标识

- ✨ 新增功能 (Feature)
- 🐛 问题修复 (Bug Fix)
- 📚 文档更新 (Documentation)
- 🔧 改进优化 (Improvement)
- 🛠️ 测试相关 (Testing)
- ⚡ 性能优化 (Performance)
- 🔒 安全更新 (Security)
- 💥 破坏性变更 (Breaking Change)

---

## 即将推出

### v1.2.0 计划

- [ ] 消息持久化（数据库集成）
- [ ] 消息历史记录
- [ ] 用户认证系统
- [ ] 消息已读回执
- [ ] 在线状态显示

### v1.3.0 计划

- [ ] 文件传输支持
- [ ] 音视频通话集成
- [ ] 房间密码保护
- [ ] 用户黑名单
- [ ] 消息搜索功能

### v2.0.0 计划

- [ ] Redis 集群支持
- [ ] 分布式部署
- [ ] 负载均衡
- [ ] Web 管理后台
- [ ] 监控和日志系统

---

## 反馈与建议

如有问题或建议，请：

1. 查看文档
2. 提交 Issue
3. 发送 Pull Request

感谢使用 E2E WebSocket 服务器！


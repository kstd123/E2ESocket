# 配置管理功能演示

## 🎬 功能演示指南

### 准备工作

1. **启动服务器**
```bash
npm install
npm start
```

2. **打开浏览器客户端**

在浏览器中打开两个标签页：
- 标签页1：`file:///path/to/examples/client.html` （管理员）
- 标签页2：`file:///path/to/examples/client.html` （成员）

### 演示步骤

#### 第一步：管理员创建房间

**在标签页1（管理员）**：

1. 输入服务器地址：`ws://localhost:8080`
2. 点击"连接"
3. 看到：✅ `已连接到服务器`
4. 房间号留空
5. 选择"可读可写"
6. 点击"加入房间"
7. 看到：
   - ✅ `成功加入房间: ABC123`
   - 标题显示：`房间: ABC123 (管理员)`
   - 出现两个新按钮：📱 二维码 | ⚙️ 配置

#### 第二步：发布初始配置

**继续在标签页1（管理员）**：

1. 点击 **"⚙️ 配置"** 按钮
2. 配置编辑器弹出
3. 输入配置：

```json
{
  "gameType": "team_battle",
  "maxPlayers": 10,
  "map": "desert",
  "settings": {
    "difficulty": "medium",
    "friendly_fire": false,
    "respawn_time": 5
  },
  "rules": [
    "No camping",
    "Team work required",
    "Have fun!"
  ]
}
```

4. 点击 **"发布配置"** 按钮
5. 看到：
   - ✅ `配置已发布，版本: 1`
   - 编辑器关闭

#### 第三步：成员加入房间

**在标签页2（成员）**：

1. 输入服务器地址：`ws://localhost:8080`
2. 点击"连接"
3. 输入房间号：`ABC123`（从标签页1复制）
4. 选择"可读可写"
5. 点击"加入房间"
6. 看到：
   - ✅ `成功加入房间: ABC123`
   - ✅ `收到配置更新，版本: 1`
   - 标题显示：`房间: ABC123`
   - 没有配置和二维码按钮（因为不是管理员）

**同时在标签页1（管理员）**：
- 看到：`新成员加入，当前人数: 2`

#### 第四步：查看配置

**在标签页2（成员）**：

1. 按 F12 打开开发者工具
2. 在控制台输入：
```javascript
console.log('当前配置:', currentConfig);
console.log('配置版本:', configVersion);
```

3. 看到完整配置内容

#### 第五步：更新配置

**回到标签页1（管理员）**：

1. 再次点击 **"⚙️ 配置"** 按钮
2. 编辑器打开，显示当前配置
3. 修改配置：

```json
{
  "gameType": "team_battle",
  "maxPlayers": 20,
  "map": "jungle",
  "settings": {
    "difficulty": "hard",
    "friendly_fire": true,
    "respawn_time": 10,
    "new_feature": "night_mode"
  },
  "rules": [
    "No camping",
    "Team work required",
    "Have fun!",
    "Watch your back!"
  ],
  "updated": "2025-11-17T10:30:00Z"
}
```

4. 点击 **"发布配置"** 按钮
5. 看到：
   - ✅ `配置已发布，版本: 2`
   - 版本号从 1 变为 2

**同时在标签页2（成员）**：
- 自动看到：✅ `配置已更新，版本: 2`
- 新配置已自动接收

#### 第六步：显示二维码

**在标签页1（管理员）**：

1. 点击 **"📱 二维码"** 按钮
2. 二维码模态框弹出
3. 显示：
   - 房间号：ABC123
   - 二维码图片

4. 可以：
   - 用手机扫描二维码
   - 截图分享给他人
   - 复制房间链接

#### 第七步：扫码加入（可选）

**用手机或第三个浏览器**：

1. 扫描二维码
2. 或直接访问：`http://localhost:3000/join?roomId=ABC123`
3. 页面自动加载，房间号已预填
4. 连接服务器后会提示自动加入

## 🎯 预期结果

### 管理员界面

```
┌─────────────────────────────────────────┐
│ 房间: ABC123 (管理员)                   │
│ 2 人在线 · admin                        │
│ [📱 二维码] [⚙️ 配置] [房间信息] [离开] │
├─────────────────────────────────────────┤
│                                         │
│ 系统: 欢迎使用 E2E WebSocket Chat      │
│ 系统: 已连接到服务器                   │
│ 系统: 成功加入房间: ABC123             │
│ 系统: 配置已发布，版本: 1              │
│ 系统: 新成员加入，当前人数: 2          │
│ 系统: 配置已发布，版本: 2              │
│                                         │
├─────────────────────────────────────────┤
│ [输入消息...]           [发送]         │
└─────────────────────────────────────────┘
```

### 成员界面

```
┌─────────────────────────────────────────┐
│ 房间: ABC123                            │
│ 2 人在线 · read_write                   │
│           [房间信息] [离开]             │
├─────────────────────────────────────────┤
│                                         │
│ 系统: 欢迎使用 E2E WebSocket Chat      │
│ 系统: 已连接到服务器                   │
│ 系统: 成功加入房间: ABC123             │
│ 系统: 收到配置更新，版本: 1            │
│ 系统: 配置已更新，版本: 2              │
│                                         │
├─────────────────────────────────────────┤
│ [输入消息...]           [发送]         │
└─────────────────────────────────────────┘
```

### 配置编辑器

```
┌─────────────────────────────────────────┐
│ 📝 房间配置编辑器                  ×   │
├─────────────────────────────────────────┤
│                                         │
│  {                                      │
│    "gameType": "team_battle",          │
│    "maxPlayers": 20,                   │
│    "map": "jungle",                    │
│    "settings": {                       │
│      "difficulty": "hard",             │
│      "friendly_fire": true,            │
│      "respawn_time": 10                │
│    }                                   │
│  }                                     │
│                                         │
├─────────────────────────────────────────┤
│ 版本: 2        [取消]  [发布配置]      │
└─────────────────────────────────────────┘
```

### 二维码显示

```
┌─────────────────────────────────────────┐
│        📱 扫码加入房间                  │
│     房间号: ABC123                      │
│                                         │
│       ┌─────────────┐                   │
│       │█████████████│                   │
│       │███  ███  ███│                   │
│       │█████████████│                   │
│       │███  ███  ███│                   │
│       │█████████████│                   │
│       └─────────────┘                   │
│                                         │
│          [关闭]                         │
└─────────────────────────────────────────┘
```

## 📊 测试检查清单

- [ ] 管理员成功创建房间
- [ ] 管理员可以打开配置编辑器
- [ ] 配置编辑器显示正常
- [ ] JSON格式验证工作正常
- [ ] 配置成功发布
- [ ] 版本号正确递增
- [ ] 成员加入时收到配置
- [ ] 配置更新实时广播
- [ ] 所有成员配置版本一致
- [ ] 非管理员看不到配置按钮
- [ ] 非管理员无法发布配置
- [ ] 二维码正确生成
- [ ] 二维码包含正确房间信息
- [ ] 扫码后可以加入房间

## 🧪 自动化测试

运行自动化测试：

```bash
npm run test:config
```

预期输出：

```
🧪 开始测试配置管理功能

1️⃣  创建管理员客户端...
✅ [Admin] 已连接
📡 [Admin] Client ID: abc-123

2️⃣  管理员创建房间...
🚪 [Admin] 加入房间: ABC123 (管理员)

3️⃣  管理员发布初始配置...
✅ [Admin] 配置已发布，版本: 1
⚙️  [Admin] 收到配置更新 v1: { title: '初始配置', ... }

4️⃣  成员1加入房间...
✅ [Member1] 已连接
🚪 [Member1] 加入房间: ABC123
⚙️  [Member1] 收到配置更新 v1: { title: '初始配置', ... }

5️⃣  成员2加入房间...
✅ [Member2] 已连接
🚪 [Member2] 加入房间: ABC123
⚙️  [Member2] 收到配置更新 v1: { title: '初始配置', ... }

6️⃣  管理员更新配置...
✅ [Admin] 配置已发布，版本: 2
📢 [Admin] 配置已广播 v2
📢 [Member1] 配置已广播 v2
📢 [Member2] 配置已广播 v2

7️⃣  成员1尝试发布配置（权限测试）...
❌ [Member1] 错误: Permission denied: Only admin can publish config

8️⃣  验证所有客户端的配置...
   Admin: v2 更新配置
   Member1: v2 更新配置
   Member2: v2 更新配置

9️⃣  清理连接...

==================================================
✅ 测试完成！
==================================================

测试结果：
✓ 管理员成功创建房间
✓ 管理员成功发布配置
✓ 新成员加入时自动接收配置
✓ 配置更新成功广播
✓ 非管理员无法发布配置
✓ 所有成员配置版本一致
```

## 💡 演示技巧

1. **并排显示**：将两个浏览器窗口并排显示，便于观察同步效果

2. **使用开发者工具**：打开控制台查看详细日志

3. **复制配置**：准备好几个配置模板，方便快速演示

4. **截图保存**：演示时保存关键步骤的截图

5. **二维码测试**：准备好手机扫码，展示跨设备功能

## 🎥 演示视频脚本

1. **开场** (30秒)
   - 介绍功能背景
   - 展示应用场景

2. **创建房间** (1分钟)
   - 管理员连接
   - 创建房间
   - 展示管理员专属按钮

3. **配置管理** (2分钟)
   - 打开配置编辑器
   - 编辑JSON配置
   - 发布配置
   - 展示版本号

4. **成员加入** (1分钟)
   - 成员连接并加入
   - 自动接收配置
   - 展示实时同步

5. **更新配置** (1分钟)
   - 管理员修改配置
   - 发布更新
   - 所有成员实时收到

6. **二维码** (1分钟)
   - 生成二维码
   - 扫码加入演示
   - 展示跨设备能力

7. **总结** (30秒)
   - 回顾核心功能
   - 强调应用价值

---

**准备好了吗？开始你的演示！** 🎬


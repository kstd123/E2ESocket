# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿéƒ¨ç½²](#å¿«é€Ÿéƒ¨ç½²)
- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [æ‰‹åŠ¨éƒ¨ç½²](#æ‰‹åŠ¨éƒ¨ç½²)
- [Nginx é…ç½®](#nginx-é…ç½®)
- [åŸŸåå’Œ HTTPS](#åŸŸåå’Œ-https)
- [é˜²ç«å¢™é…ç½®](#é˜²ç«å¢™é…ç½®)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [ç›‘æ§å’Œæ—¥å¿—](#ç›‘æ§å’Œæ—¥å¿—)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
# 1. å…‹éš†é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git clone <your-repo-url> /var/www/e2eSocket
cd /var/www/e2eSocket

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
chmod +x scripts/deploy.sh
./scripts/deploy.sh production

# 3. å®Œæˆï¼è®¿é—® http://your-server-ip:3001
```

---

## ğŸ’» ç³»ç»Ÿè¦æ±‚

### æœ€ä½é…ç½®

- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+, CentOS 7+) æˆ–å…¶ä»–ç±»Unixç³»ç»Ÿ
- **CPU**: 1 æ ¸å¿ƒ
- **å†…å­˜**: 512MB
- **ç£ç›˜**: 1GB å¯ç”¨ç©ºé—´
- **Node.js**: 16.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm**: 7.x æˆ–æ›´é«˜ç‰ˆæœ¬

### æ¨èé…ç½®

- **CPU**: 2+ æ ¸å¿ƒ
- **å†…å­˜**: 2GB+
- **ç£ç›˜**: 5GB+ SSD
- **å¸¦å®½**: 10Mbps+

### ç«¯å£è¦æ±‚

- **8080**: WebSocket æœåŠ¡
- **3001**: HTTP API å’Œ Web å®¢æˆ·ç«¯
- **80/443** (å¯é€‰): Nginx åå‘ä»£ç†

---

## ğŸ“¦ æ‰‹åŠ¨éƒ¨ç½²

### æ­¥éª¤ 1: å‡†å¤‡æœåŠ¡å™¨

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…è¦å·¥å…·
sudo apt install -y git curl build-essential

# å®‰è£… Node.js (ä½¿ç”¨ nvm)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18
node --version
```

### æ­¥éª¤ 2: å…‹éš†é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/e2eSocket
sudo chown $USER:$USER /var/www/e2eSocket

# å…‹éš†ä»£ç 
cd /var/www/e2eSocket
git clone <your-repo-url> .
```

### æ­¥éª¤ 3: å®‰è£…ä¾èµ–

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
npm ci --production

# å…¨å±€å®‰è£… PM2
npm install -g pm2
```

### æ­¥éª¤ 4: é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

```bash
# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << EOF
NODE_ENV=production
WS_PORT=8080
API_PORT=3001
EOF
```

### æ­¥éª¤ 5: å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨ PM2 å¯åŠ¨
pm2 start ecosystem.config.js --env production

# ä¿å­˜ PM2 é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
# æŒ‰ç…§æç¤ºæ‰§è¡Œå‘½ä»¤ï¼ˆéœ€è¦ sudoï¼‰
```

### æ­¥éª¤ 6: éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs e2e-socket

# æµ‹è¯• API
curl http://localhost:3001/health

# æµ‹è¯• Web å®¢æˆ·ç«¯
curl http://localhost:3001/
```

---

## ğŸŒ Nginx é…ç½®

### å®‰è£… Nginx

```bash
# Ubuntu/Debian
sudo apt install -y nginx

# CentOS/RHEL
sudo yum install -y nginx

# å¯åŠ¨ Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

### é…ç½®åå‘ä»£ç†

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
sudo cp config/nginx.conf /etc/nginx/sites-available/e2e-socket

# ç¼–è¾‘é…ç½®ï¼Œæ›¿æ¢åŸŸå
sudo nano /etc/nginx/sites-available/e2e-socket
# ä¿®æ”¹ server_name ä¸ºä½ çš„åŸŸå

# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/e2e-socket /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½
sudo systemctl reload nginx
```

### WebSocket è·¯ç”±é…ç½®

å¦‚æœä½¿ç”¨ Nginxï¼Œéœ€è¦æ›´æ–° WebSocket è¿æ¥åœ°å€ï¼š

```javascript
// åœ¨ client.html ä¸­
const wsUrl = 'ws://your-domain.com/ws';
```

æˆ–è€…ç›´æ¥ä½¿ç”¨ç«¯å£ï¼š

```javascript
const wsUrl = 'ws://your-domain.com:8080';
```

---

## ğŸ”’ åŸŸåå’Œ HTTPS

### ä½¿ç”¨ Let's Encrypt è·å–å…è´¹ SSL è¯ä¹¦

```bash
# å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# è‡ªåŠ¨ç»­æœŸï¼ˆCertbot ä¼šè‡ªåŠ¨æ·»åŠ  cron ä»»åŠ¡ï¼‰
sudo certbot renew --dry-run
```

### é…ç½® HTTPS

```bash
# ç¼–è¾‘ Nginx é…ç½®
sudo nano /etc/nginx/sites-available/e2e-socket

# å–æ¶ˆæ³¨é‡Š HTTPS é…ç½®éƒ¨åˆ†
# ä¿®æ”¹è¯ä¹¦è·¯å¾„å’ŒåŸŸå

# é‡æ–°åŠ è½½
sudo nginx -t
sudo systemctl reload nginx
```

### æ›´æ–°å®¢æˆ·ç«¯é…ç½®

HTTPS é…ç½®å®Œæˆåï¼ŒWebSocket éœ€è¦ä½¿ç”¨ WSSï¼š

```javascript
// client.html ä¼šè‡ªåŠ¨æ£€æµ‹
const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
const wsUrl = `${wsProtocol}//your-domain.com/ws`;
```

---

## ğŸ”¥ é˜²ç«å¢™é…ç½®

### UFW (Ubuntu)

```bash
# å…è®¸ SSH
sudo ufw allow ssh

# å…è®¸ HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å…è®¸ WebSocket ç«¯å£ï¼ˆå¦‚æœä¸ä½¿ç”¨ Nginx ä»£ç†ï¼‰
sudo ufw allow 8080/tcp

# å…è®¸ API ç«¯å£ï¼ˆå¦‚æœä¸ä½¿ç”¨ Nginx ä»£ç†ï¼‰
sudo ufw allow 3001/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

### Firewalld (CentOS)

```bash
# å…è®¸ HTTP/HTTPS
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https

# å…è®¸ WebSocket å’Œ API ç«¯å£
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --permanent --add-port=3001/tcp

# é‡æ–°åŠ è½½
sudo firewall-cmd --reload

# æŸ¥çœ‹çŠ¶æ€
sudo firewall-cmd --list-all
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### PM2 é›†ç¾¤æ¨¡å¼

å¦‚æœæœåŠ¡å™¨æœ‰å¤šä¸ª CPU æ ¸å¿ƒï¼Œå¯ä»¥ä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼š

```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'e2e-socket',
    script: './server.js',
    instances: 'max',  // ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒ
    exec_mode: 'cluster',
    max_memory_restart: '1G'
  }]
};
```

### Node.js æ€§èƒ½ä¼˜åŒ–

```bash
# å¢åŠ æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°
ulimit -n 65536

# æ°¸ä¹…é…ç½®
echo "* soft nofile 65536" | sudo tee -a /etc/security/limits.conf
echo "* hard nofile 65536" | sudo tee -a /etc/security/limits.conf
```

### Nginx ä¼˜åŒ–

```nginx
# /etc/nginx/nginx.conf
worker_processes auto;
worker_connections 4096;

# å¯ç”¨ gzip å‹ç¼©
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css text/xml text/javascript 
           application/json application/javascript application/xml+rss;
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### PM2 ç›‘æ§

```bash
# å®æ—¶ç›‘æ§
pm2 monit

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show e2e-socket

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs e2e-socket --lines 100

# åˆ·æ–°æ—¥å¿—
pm2 flush
```

### æ—¥å¿—ç®¡ç†

```bash
# é…ç½®æ—¥å¿—è½®è½¬
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true
```

### ç³»ç»Ÿèµ„æºç›‘æ§

```bash
# å®‰è£… htop
sudo apt install -y htop

# ç›‘æ§ç³»ç»Ÿèµ„æº
htop

# ç›‘æ§ç½‘ç»œè¿æ¥
netstat -tunlp | grep -E '8080|3001'
```

### PM2 Plusï¼ˆé«˜çº§ç›‘æ§ï¼‰

```bash
# æ³¨å†Œ PM2 Plusï¼ˆå…è´¹ï¼‰
pm2 plus

# é“¾æ¥æœåŠ¡å™¨
pm2 link <secret> <public>
```

è®¿é—® https://app.pm2.io æŸ¥çœ‹è¯¦ç»†ç›‘æ§ã€‚

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs e2e-socket --err

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tunlp | grep -E '8080|3001'

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
node server.js
```

#### 2. WebSocket è¿æ¥å¤±è´¥

```bash
# æµ‹è¯• WebSocket ç«¯å£
telnet localhost 8080

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
sudo tail -f /var/log/nginx/error.log
```

#### 3. å®¢æˆ·ç«¯æ— æ³•åŠ è½½

```bash
# æ£€æŸ¥é™æ€æ–‡ä»¶è·¯å¾„
ls -la examples/client.html

# æµ‹è¯• HTTP æœåŠ¡
curl -I http://localhost:3001/client/client.html

# æŸ¥çœ‹ API æœåŠ¡æ—¥å¿—
pm2 logs e2e-socket
```

#### 4. å†…å­˜æ³„æ¼

```bash
# é‡å¯æœåŠ¡
pm2 restart e2e-socket

# é™ä½æœ€å¤§å†…å­˜é™åˆ¶è‡ªåŠ¨é‡å¯
pm2 restart e2e-socket --max-memory-restart 500M
```

### æ—¥å¿—çº§åˆ«

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯ä»¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼š

```javascript
// server.js
const logLevel = process.env.NODE_ENV === 'production' ? 'error' : 'debug';
```

### å¥åº·æ£€æŸ¥

```bash
# åˆ›å»ºå¥åº·æ£€æŸ¥è„šæœ¬
cat > /usr/local/bin/e2e-health-check.sh << 'EOF'
#!/bin/bash
HEALTH_URL="http://localhost:3001/health"
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" $HEALTH_URL)

if [ $RESPONSE -eq 200 ]; then
    echo "âœ“ Service is healthy"
    exit 0
else
    echo "âœ— Service is down (HTTP $RESPONSE)"
    pm2 restart e2e-socket
    exit 1
fi
EOF

chmod +x /usr/local/bin/e2e-health-check.sh

# æ·»åŠ åˆ° crontabï¼ˆæ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
(crontab -l 2>/dev/null; echo "*/5 * * * * /usr/local/bin/e2e-health-check.sh >> /var/log/e2e-health.log 2>&1") | crontab -
```

---

## ğŸ“ ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š

- [ ] Node.js ç‰ˆæœ¬æ­£ç¡® (16+)
- [ ] æ‰€æœ‰ä¾èµ–å·²å®‰è£…
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ç«¯å£æœªè¢«å ç”¨
- [ ] é˜²ç«å¢™è§„åˆ™å·²è®¾ç½®
- [ ] PM2 å·²å…¨å±€å®‰è£…
- [ ] æ—¥å¿—ç›®å½•å·²åˆ›å»º

éƒ¨ç½²åéªŒè¯ï¼š

- [ ] PM2 è¿›ç¨‹è¿è¡Œæ­£å¸¸
- [ ] WebSocket è¿æ¥æ­£å¸¸
- [ ] HTTP API å“åº”æ­£å¸¸
- [ ] Web å®¢æˆ·ç«¯å¯è®¿é—®
- [ ] äºŒç»´ç åŠŸèƒ½æ­£å¸¸
- [ ] é…ç½®ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] PM2 å¼€æœºè‡ªå¯å·²é…ç½®

å®‰å…¨æ£€æŸ¥ï¼š

- [ ] SSH å¯†é’¥è®¤è¯
- [ ] é˜²ç«å¢™å·²å¯ç”¨
- [ ] åªå¼€æ”¾å¿…è¦ç«¯å£
- [ ] HTTPS å·²é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] æ•æ„Ÿä¿¡æ¯æœªæš´éœ²
- [ ] æ—¥å¿—æ–‡ä»¶æƒé™æ­£ç¡®

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# éƒ¨ç½²
./scripts/deploy.sh production

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs e2e-socket

# é‡å¯æœåŠ¡
pm2 restart e2e-socket

# åœæ­¢æœåŠ¡
pm2 stop e2e-socket

# åˆ é™¤æœåŠ¡
pm2 delete e2e-socket

# ç›‘æ§
pm2 monit

# ä¿å­˜é…ç½®
pm2 save

# é‡æ–°åŠ è½½ï¼ˆæ— åœæœºï¼‰
pm2 reload e2e-socket

# Nginx ç›¸å…³
sudo nginx -t              # æµ‹è¯•é…ç½®
sudo systemctl reload nginx # é‡æ–°åŠ è½½
sudo tail -f /var/log/nginx/access.log  # æŸ¥çœ‹è®¿é—®æ—¥å¿—
```

---

## ğŸ†˜ è·å–å¸®åŠ©

- **é¡¹ç›®æ–‡æ¡£**: README.md
- **å¿«é€Ÿå¼€å§‹**: QUICKSTART.md
- **åŠŸèƒ½æ–‡æ¡£**: docs/
- **GitHub Issues**: <your-repo-url>/issues

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰

